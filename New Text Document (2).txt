@SuppressWarnings("unchecked")
Map<String, Object> categories =
        (Map<String, Object>) usageData.get("categories");

if (categories == null) {
    categories = new HashMap<>();
    usageData.put("categories", categories);
}

double currentCategoryTotal =
        categories.get(category) instanceof Number
                ? ((Number) categories.get(category)).doubleValue()
                : 0.0;

categories.put(category, currentCategoryTotal + amount);
